<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="../static/css/login.css">
</head>
<body>
    <div class="container-login">
    <div class="left-panel">
    <div class="logo">
    </div>

    <div class="welcome-text">
        <h2 class="welcome-title">Iniciar Sesión</h2>
        <h1 class="main-title">¡Bienvenido!</h1>
        <p class="welcome-subtext">Inicia sesión y empieza a donar sangre y salvar vidas</p>
    </div>
    </div>
    <div class="right-panel">
        <form class="loginForm" id="loginForm">
            <label for="email">Correo electrónico</label>
            <input type="email" name="email" id="email" placeholder="nombre@gmail.com" required>

            <label for="password">Contraseña</label>
            <input type="password" name="password" id="password" placeholder="**********" required>

            <button type="submit" class="btn-login">Iniciar Sesión</button>
            <a href="{{ url_for('donaciones_web.registroDonante') }}" class="btn-register">
                Crear una cuenta nueva</a>
        </form>
    </div>
</div>
    
<script>
document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const email = document.getElementById("email").value;
    const contrasena = document.getElementById("password").value;

    try {
        const response = await fetch("/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, contrasena })
        });

        const data = await response.json();

        if (!response.ok) {
            alert(data.error || "Error al iniciar sesión");
            return;
        }

        alert(data.mensaje||"Inicio de sesión exitoso");
        window.location.href = data.redirect;   
    } 
    catch (error) {
        alert("Error en el servidor");
    }
});

const params = new URLSearchParams(window.location.search);
if (params.get("expired") === "1") {
    alert("Tu sesión ha expirado. Por favor vuelve a iniciar sesión.");
}


</script>

</body>
</html>
