    {% extends "partials/doctor_nav.html" %}

    {% block titulo %}Donador{% endblock %}
    {% block titulo_header %}Perfil del Donador{% endblock %}

    {% set active_page = "citas" %}

    {% block contenido %}
    <header>
        <link rel="stylesheet" href="../static/css/evaluacion.css">
    </header>

    <!-- === NUEVO HEADER CON FOTO IZQ + INFO DER === -->
    <div class="perfil-header">
        
        <!-- FOTO IZQUIERDA -->
        <div class="perfil-col-der">
            <img src="{{ url_for('static', filename='img/icono.jpg') }}" class="perfil-foto" alt="Foto">
        </div>

        <!-- INFO DERECHA -->
        <div class="perfil-col-izq">
            <h2>{{ agendamiento.nombre }} {{ agendamiento.apellido }}</h2>

            <span class="estado {{ 'disponible' if agendamiento.disponible_para_donar else 'no-disponible' }}">
                {{ 'Disponible' if agendamiento.disponible_para_donar else 'No disponible' }}
            </span>

            <p class="tipo-sangre">
                <span>ü©∏</span>
                Tipo de sangre: <strong>{{ agendamiento.tipo_sangre }}</strong>
            </p>
        </div>

    </div>
    <!-- === GRID DE DATOS DEL DONANTE EN 2 COLUMNAS === -->
    <div class="datos-donante-grid">

        <div class="dato-item">
            <label>Edad</label>
            <p>{{ agendamiento.edad }} a√±os</p>
        </div>

        <div class="dato-item">
            <label>Tel√©fono</label>
            <p>{{ agendamiento.telefono }}</p>
        </div>

        <div class="dato-item">
            <label>Direcci√≥n</label>
            <p>{{ agendamiento.direccion }}</p>
        </div>

        <div class="dato-item">
            <label>√öltima donaci√≥n</label>
            <p>{{ agendamiento.ultima_donacion if agendamiento.ultima_donacion else 'No registra' }}</p>
        </div>

    </div>

        <h3 class="titulo-form">Verificaci√≥n de Aptitud</h3>

    <div class="aptitud-grid">

        <div class="campo">
            <label><span class="icon">‚öñÔ∏è</span> Peso (kg)</label>
            <input type="number" step="0.1" placeholder="Ej: 65.5">
        </div>

        <div class="campo">
            <label><span class="icon">ü§ç</span> Presi√≥n arterial (mmHg)</label>
            <input type="text" placeholder="Ej: 120/80">
        </div>

        <div class="campo">
            <label><span class="icon">üå°Ô∏è</span> Temperatura (¬∞C)</label>
            <input type="number" placeholder="Ej: 36.5">
        </div>

        <div class="campo">
            <label><span class="icon">ü©∏</span> Hemoglobina (g/dL)</label>
            <input type="number" step="0.1" placeholder="Ej: 14.5">
        </div>

        <div class="campo" id="comentarios-box">
            <label>Comentarios</label>
            <textarea name="comentarios" rows="3" placeholder="" type="text"></textarea>
        </div>

        <div class="campo">
            <label>Resultado de la evaluaci√≥n</label>
            <select name="resultado" required>
                <option value="">Seleccione...</option>
                <option value="apto">Aprobado</option>
                <option value="no_apto">Rechazado</option>
            </select>
        </div>
    </div>

    <button type="submit" class="btn-guardar">Guardar evaluaci√≥n</button>
    </form> 
    <!--falta un pequeno logout-->
    {% endblock %}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Selecciona el formulario por su ID
            const form = document.getElementById('form-evaluacion');
            
            // 2. Escucha el evento de env√≠o del formulario
            form.addEventListener('submit', async (e) => {
                e.preventDefault(); // <-- ¬°IMPORTANTE! Detiene el env√≠o HTTP tradicional (recarga de p√°gina)

                // Crea un objeto con los datos del formulario
                const formData = new FormData(form);
                const url = form.action; 

                try {
                    // 3. Env√≠a los datos de forma as√≠ncrona (AJAX)
                    const response = await fetch(url, {
                        method: 'POST',
                        body: formData,
                    });

                    // 4. Parsea la respuesta JSON
                    const data = await response.json(); 

                    if (response.ok && data.success) {
                        // √âXITO (status 200 y success: true)
                        alert(`‚úÖ √âxito: ${data.message}`);
                        
                        // Opcional: Recargar la p√°gina o redirigir despu√©s del √©xito
                        // window.location.reload(); 
                        // window.location.href = "{{ url_for('web_bp.admin') }}"; 
                    } else {
                        // ERROR (status 400, 500 o success: false)
                        // Usa el mensaje de error que enviamos desde Flask
                        alert(`‚ùå Error al guardar: ${data.message}`);
                    }
                } catch (error) {
                    // Error de red, conexi√≥n o JSON inv√°lido
                    alert(`‚ùå Error de conexi√≥n o comunicaci√≥n con el servidor: ${error.message}`);
                }
            });
        });
    </script>